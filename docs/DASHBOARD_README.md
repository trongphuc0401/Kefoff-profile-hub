# ğŸ“Š Kefoff Profile Hub - Dashboard README

## ğŸ¯ Tá»•ng Quan

**Kefoff Profile Hub** lÃ  má»™t á»©ng dá»¥ng Shopify tÃ­ch há»£p Customer Account UI Extension, cho phÃ©p khÃ¡ch hÃ ng quáº£n lÃ½ vÃ  theo dÃµi cÃ¡c Pass (tháº» thÃ nh viÃªn) cá»§a há» trá»±c tiáº¿p trÃªn trang tÃ i khoáº£n.

## âœ¨ TÃ­nh NÄƒng ChÃ­nh

### 1. ğŸ« Quáº£n LÃ½ Pass ThÃ nh ViÃªn

Dashboard hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin vá» Pass cá»§a khÃ¡ch hÃ ng, bao gá»“m:

- **ThÃ´ng tin cÆ¡ báº£n:**
  - TÃªn Pass (Pass Name)
  - MÃ£ Pass (Pass Code) vá»›i badge Ä‘áº·c biá»‡t
  - TÃªn ngÆ°á»i sá»­ dá»¥ng (User Name)
  - HÃ¬nh áº£nh Pass tÃ¹y chá»‰nh

- **Thá»i háº¡n sá»­ dá»¥ng:**
  - NgÃ y báº¯t Ä‘áº§u (Start Date)
  - NgÃ y háº¿t háº¡n (Expiry Date)
  - Hiá»ƒn thá»‹ Ä‘á»‹nh dáº¡ng ngÃ y theo chuáº©n Viá»‡t Nam (dd/mm/yyyy)

### 2. ğŸ“ˆ Theo DÃµi LÆ°á»£t Sá»­ Dá»¥ng

#### Student Pass & Friendship Pass
- **Giá»›i háº¡n:** 15 lÆ°á»£t sá»­ dá»¥ng
- **Hiá»ƒn thá»‹ trá»±c quan:**
  - Progress bar vá»›i mÃ u sáº¯c Ä‘á»™ng (success/warning/critical)
  - Grid 5x3 vá»›i 15 Ã´ biá»ƒu tÆ°á»£ng cÃ  phÃª â˜•
  - Äáº¿m sá»‘ lÆ°á»£t cÃ²n láº¡i vÃ  pháº§n trÄƒm Ä‘Ã£ sá»­ dá»¥ng
  - Cáº£nh bÃ¡o khi cÃ²n â‰¤ 5 lÆ°á»£t

#### Ultimate Pass
- **Countdown Timer 4 giá»:**
  - Hiá»ƒn thá»‹ thá»i gian cÃ²n láº¡i theo Ä‘á»‹nh dáº¡ng HH:MM:SS
  - Progress bar theo thá»i gian thá»±c
  - Tá»± Ä‘á»™ng cáº­p nháº­t má»—i giÃ¢y
  - ThÃ´ng bÃ¡o khi sáºµn sÃ ng sá»­ dá»¥ng láº¡i

### 3. ğŸ“… Lá»‹ch Sá»­ Sá»­ Dá»¥ng

**Calendar View vá»›i cÃ¡c tÃ­nh nÄƒng:**

- **Äiá»u hÆ°á»›ng thÃ¡ng:**
  - NÃºt Previous/Next Ä‘á»ƒ chuyá»ƒn thÃ¡ng
  - Hiá»ƒn thá»‹ thÃ¡ng/nÄƒm Ä‘ang xem
  - Tá»± Ä‘á»™ng tÃ­nh toÃ¡n ngÃ y Ä‘áº§u/cuá»‘i thÃ¡ng

- **Hiá»ƒn thá»‹ tráº¡ng thÃ¡i ngÃ y:**
  - **NgÃ y hÃ´m nay:** Text Ä‘áº­m (strong)
  - **NgÃ y quÃ¡ khá»©:** Text bÃ¬nh thÆ°á»ng (base)
  - **NgÃ y tÆ°Æ¡ng lai:** Text má» (subdued)

- **Icon theo mÃ¹a (Seasonal Icons):**
  - ğŸŒ¸ **XuÃ¢n** (ThÃ¡ng 2-4): Icon cÃ  phÃª
  - â˜€ï¸ **Háº¡** (ThÃ¡ng 5-7): Icon cÃ  phÃª
  - ğŸ‚ **Thu** (ThÃ¡ng 8-10): Icon cÃ  phÃª
  - â„ï¸ **ÄÃ´ng** (ThÃ¡ng 11-1): Icon lÃ¡ mÃ¹a Ä‘Ã´ng

- **Äáº¿m sá»‘ láº§n sá»­ dá»¥ng:**
  - Ultimate Pass: Hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng náº¿u > 1 láº§n/ngÃ y
  - Pass khÃ¡c: Hiá»ƒn thá»‹ icon mÃ¹a
  - NgÃ y chÆ°a sá»­ dá»¥ng: Hiá»ƒn thá»‹ â—‹

### 4. ğŸ”„ Gia Háº¡n Pass

- **Kiá»ƒm tra tráº¡ng thÃ¡i gia háº¡n:**
  - Icon âœ“ (success) náº¿u thÃ¡ng Ä‘Ã£ gia háº¡n
  - Icon âš ï¸ (critical) náº¿u thÃ¡ng chÆ°a gia háº¡n
  - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o rÃµ rÃ ng

- **NÃºt gia háº¡n:**
  - Link trá»±c tiáº¿p Ä‘áº¿n trang sáº£n pháº©m
  - Icon giá» hÃ ng + text "Gia háº¡n Pass"
  - Variant primary Ä‘á»ƒ ná»•i báº­t

### 5. ğŸ¨ Giao Diá»‡n Responsive

**Layout Grid:**
- **Mobile:** Hiá»ƒn thá»‹ dá»c (Pass image trÃªn, thÃ´ng tin dÆ°á»›i)
- **Desktop:** Hiá»ƒn thá»‹ ngang (Pass image trÃ¡i, thÃ´ng tin pháº£i)
- **Auto-fit:** Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh theo mÃ n hÃ¬nh

**Spacing & Padding:**
- Sá»­ dá»¥ng Shopify Polaris spacing tokens
- Padding nháº¥t quÃ¡n: `small-200`, `small-400`, `base`, `large-100`, `large-500`
- Gap responsive cho cÃ¡c stack vÃ  grid

## ğŸ› ï¸ CÃ´ng Nghá»‡ Sá»­ Dá»¥ng

### Frontend
- **Framework:** Preact (lightweight React alternative)
- **UI Components:** Shopify Polaris Web Components
  - `s-section`, `s-stack`, `s-grid`
  - `s-banner`, `s-badge`, `s-button`
  - `s-icon`, `s-image`, `s-text`, `s-heading`
  - `s-progress`, `s-divider`

### Data Management
- **GraphQL API:** Shopify Customer Account API 2025-10
- **Metafields:**
  - `custom.pass_info` (JSON): ThÃ´ng tin Pass
  - `custom.usage_count` (number): Sá»‘ láº§n Ä‘Ã£ sá»­ dá»¥ng
  - `custom.used_dates` (JSON): Máº£ng timestamps Ä‘Ã£ sá»­ dá»¥ng

### State Management
- **Preact Hooks:**
  - `useState`: Quáº£n lÃ½ state component
  - `useEffect`: Side effects vÃ  data fetching

## ğŸ“Š Cáº¥u TrÃºc Dá»¯ Liá»‡u

### Pass Info Metafield (JSON)
```json
{
  "passName": "Student Pass",
  "passCode": "STUDENT-2025",
  "userName": "Nguyá»…n VÄƒn A",
  "usageLimit": 15,
  "startDate": "2025-04-01",
  "expiryDate": "2025-05-28",
  "passImage": "https://cdn.shopify.com/...",
  "passUrl": "https://kefoff.vn/products/student-pass"
}
```

### Used Dates Metafield (JSON Array)
```json
[
  "2025-12-01T08:30:00Z",
  "2025-12-02T14:25:59Z",
  "2025-12-03T10:15:30Z"
]
```

## ğŸ”§ Cáº¥u HÃ¬nh Extension

### Settings Schema
```javascript
{
  heading_text: "Tháº» thÃ nh viÃªn cá»§a báº¡n",
  metafield_namespace: "custom",
  metafield_key: "pass_info",
  empty_state_text: "Báº¡n chÆ°a cÃ³ Pass nÃ o"
}
```

### Translations (i18n)
- `heading_default`: "Membership Pass"
- `banner_info_heading`: "ThÃ´ng tin quan trá»ng"
- `banner_info_content`: "Vui lÃ²ng kiá»ƒm tra thÃ´ng tin Pass..."
- `pass_details_heading`: "Chi tiáº¿t Pass"
- `label_pass_name`: "Loáº¡i Pass"
- `label_pass_code`: "MÃ£ Pass"
- `label_user`: "NgÆ°á»i sá»­ dá»¥ng"
- `label_usage`: "ÄÃ£ sá»­ dá»¥ng"
- `label_start_date`: "NgÃ y báº¯t Ä‘áº§u"
- `label_expiry_date`: "NgÃ y háº¿t háº¡n"
- `history_heading`: "Lá»‹ch sá»­ sá»­ dá»¥ng"
- `loading`: "Äang táº£i..."
- `error_loading`: "Lá»—i khi táº£i dá»¯ liá»‡u"

## ğŸš€ TÃ­nh NÄƒng Ná»•i Báº­t

### 1. Real-time Countdown
- TÃ­nh toÃ¡n thá»i gian thá»±c má»—i giÃ¢y
- KhÃ´ng cáº§n reload trang
- Tá»± Ä‘á»™ng dá»«ng khi háº¿t thá»i gian

### 2. Safari Compatibility
- Fetch with timeout (10s)
- Error handling cho Safari
- Fallback messages rÃµ rÃ ng

### 3. Test Mode
```javascript
const TEST_MODE = false; // Báº­t Ä‘á»ƒ test vá»›i dá»¯ liá»‡u máº«u
```

### 4. Dynamic Icons
- Array SEASON_ICONS cÃ³ thá»ƒ thay Ä‘á»•i dá»… dÃ ng
- Tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh mÃ¹a theo thÃ¡ng
- Há»— trá»£ custom icon cho tá»«ng mÃ¹a

## ğŸ“± Responsive Design

### Breakpoints
- **Mobile:** < 768px - Layout dá»c, grid 1 cá»™t
- **Tablet:** 768px - 1024px - Grid auto-fit
- **Desktop:** > 1024px - Grid 2 cá»™t, layout ngang

### Grid System
```html
<!-- Auto-responsive grid -->
<s-grid gridTemplateColumns="repeat(auto-fit, minmax(250px, 1fr))">
  <!-- Content -->
</s-grid>

<!-- Calendar grid -->
<s-grid gridTemplateColumns="repeat(auto-fill, minmax(40px, 1fr))">
  <!-- Days -->
</s-grid>
```

## ğŸ¯ User Experience

### Visual Feedback
- **Loading states:** Spinner + text
- **Error states:** Critical banner vá»›i message
- **Empty states:** Subdued text vá»›i hÆ°á»›ng dáº«n
- **Success states:** Success banner + icon

### Color Coding
- **Success (Green):** Pass cÃ²n háº¡n, Ä‘á»§ lÆ°á»£t
- **Warning (Yellow):** CÃ²n 6-10 lÆ°á»£t
- **Critical (Red):** CÃ²n â‰¤ 5 lÆ°á»£t hoáº·c háº¿t háº¡n
- **Info (Blue):** Countdown timer

### Accessibility
- Alt text cho táº¥t cáº£ images
- Semantic HTML vá»›i Polaris components
- Icon + text cho clarity
- Color + icon Ä‘á»ƒ khÃ´ng phá»¥ thuá»™c mÃ u sáº¯c

## ğŸ” Security & Performance

### Data Fetching
- GraphQL vá»›i variables Ä‘á»ƒ trÃ¡nh injection
- Timeout 10s Ä‘á»ƒ trÃ¡nh hang
- Error boundary vá»›i try-catch
- Cancel token Ä‘á»ƒ cleanup

### Performance
- Lazy loading images
- Efficient re-renders vá»›i useEffect dependencies
- Minimal state updates
- Optimized calendar rendering (chá»‰ render thÃ¡ng hiá»‡n táº¡i)

## ğŸ“ Changelog Highlights

### Version 2.2 - Safari Fix
- âœ… ThÃªm fetch timeout cho Safari
- âœ… Enhanced error logging
- âœ… Browser detection

### Version 2.1 - Calendar Navigation
- âœ… ThÃªm nÃºt Previous/Next month
- âœ… State cho viewingMonth/viewingYear
- âœ… Dynamic calendar rendering

### Version 2.0 - Student Pass Tracker
- âœ… Grid 5x3 vá»›i 15 coffee cups
- âœ… Progress bar vá»›i color coding
- âœ… Usage warnings

### Version 1.5 - Ultimate Pass Countdown
- âœ… 4-hour countdown timer
- âœ… Real-time updates
- âœ… Progress visualization

### Version 1.0 - Initial Release
- âœ… Basic pass info display
- âœ… Calendar history view
- âœ… Metafield integration

## ğŸ¤ TÃ­ch Há»£p Shopify Flow

Dashboard tá»± Ä‘á»™ng Ä‘á»“ng bá»™ vá»›i Shopify Flow Ä‘á»ƒ:
- Cáº­p nháº­t `usage_count` khi cÃ³ order má»›i
- ThÃªm timestamp vÃ o `used_dates`
- Trigger countdown cho Ultimate Pass

**Xem thÃªm:** [`docs/SHOPIFY_FLOW_SETUP.md`](./SHOPIFY_FLOW_SETUP.md)

## ğŸ“š Documentation

- **Metafield Setup:** [`docs/METAFIELD_SETUP.md`](./METAFIELD_SETUP.md)
- **Shopify Flow:** [`docs/SHOPIFY_FLOW_SETUP.md`](./SHOPIFY_FLOW_SETUP.md)
- **Main README:** [`README.md`](../README.md)

## ğŸ¨ Design System

### Icons
Táº¥t cáº£ icons tá»« Shopify CDN:
- `card.svg` - Pass name
- `lock.svg` - Pass code
- `profile.svg` - User name
- `coffee.svg` - Usage count
- `calendar.svg` - Dates
- `timer.svg` - Expiry
- `Layer_1_4.svg` - Winter season

### Typography
- **Heading:** Polaris heading component
- **Strong text:** `type="strong"`
- **Subdued text:** `color="subdued"`
- **Base text:** Default styling

### Spacing Scale
- `small-200`: 8px
- `small-400`: 16px
- `base`: 20px
- `large-100`: 24px
- `large-500`: 40px

## ğŸ› Debugging

### Console Logs
```javascript
console.log('ğŸ” Safari Debug: Component mounted');
console.log('â° Countdown set from timestamp:', timestamp);
console.log('=== CALENDAR RENDER ===');
```

### Test Mode
Báº­t `TEST_MODE = true` Ä‘á»ƒ test vá»›i dá»¯ liá»‡u máº«u mÃ  khÃ´ng cáº§n GraphQL.

## ğŸš§ Roadmap

### Planned Features
- [ ] Export lá»‹ch sá»­ sá»­ dá»¥ng (PDF/CSV)
- [ ] Push notifications khi gáº§n háº¿t háº¡n
- [ ] TÃ­ch há»£p QR code cho Pass
- [ ] Multi-language support (EN/VI)
- [ ] Dark mode support
- [ ] Analytics dashboard cho admin

### Known Issues
- Safari cÃ³ thá»ƒ timeout vá»›i máº¡ng cháº­m (Ä‘Ã£ cÃ³ fallback)
- Calendar khÃ´ng hiá»ƒn thá»‹ multiple passes (future enhancement)

## ğŸ“ Support

Náº¿u gáº·p váº¥n Ä‘á», vui lÃ²ng kiá»ƒm tra:
1. Metafields Ä‘Ã£ Ä‘Æ°á»£c setup Ä‘Ãºng chÆ°a
2. Shopify Flow Ä‘Ã£ active chÆ°a
3. Extension Ä‘Ã£ Ä‘Æ°á»£c deploy chÆ°a
4. Browser console cÃ³ error gÃ¬ khÃ´ng

---

**Developed with â¤ï¸ for Kefoff Coffee**

*Last updated: December 2025*
